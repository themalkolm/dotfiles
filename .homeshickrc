#!/bin/bash

ORIGINAL_TAPS="$(brew tap)"

function do_untap {
  for tap in $ORIGINAL_TAPS; do
    brew untap $tap
  done
}

function do_tap {
  for tap in $ORIGINAL_TAPS; do
    brew tap $tap
  done
}

trap do_tap EXIT

test $(which brew | wc -l) -eq 0 &&
  ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"

do_untap

GIT_MERGE_AUTOEDIT='no' brew update
brew upgrade

brew bundle "$(homesick show_path dotfiles)/home"
brew cleanup

# dunno, brew suggests me to do it
pip install --upgrade setuptools
pip install --upgrade pip

#
# symlink projects, legacy reasons
#
if ! test -e ~/Documents/projects; then
  mkdir -p ~/Documents/projects
  ln -s ~/Documents/projects ~/projects
fi

PROJECTS_DIR=~/projects

#
# git-boots is my own git toolset
#
if cd $PROJECTS_DIR/git-boots &> /dev/null
then
  git pull
  cd ..
else
  git clone git@github.com:themalkolm/git-boots.git $PROJECTS_DIR/git-boots
fi

# mac defaults
defaults write com.apple.finder AppleShowAllFiles -bool YES
